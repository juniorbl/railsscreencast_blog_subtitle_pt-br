1
00:00:00,000 --> 00:00:04,969
Bem vindo. Nesse screencast de 15 minutos vamos criar um blog em Ruby on Rails.

2
00:00:04,969 --> 00:00:10,936
Vamos começar com o comando "rails" passando "blog" pra ele e isso vai gerar os arquivos necessarios pra a aplicaÃ§Ã£o inicial em Rails.

3
00:00:11,600 --> 00:00:14,117
EntÃ£o podemos ir lÃ¡ e iniciar nosso servidor.

4
00:00:15,400 --> 00:00:20,340
Agora podemos ver se tudo estÃ¡ funcionando atÃ© aqui apontando nosso browser para localhost, porta 3000.

5
00:00:21,069 --> 00:00:22,956
Ai estÃ¡, parece que deu tudo certo.

6
00:00:23,367 --> 00:00:25,774
Nessa aplicaÃ§Ã£o queremos ter "posts".

7
00:00:26,586 --> 00:00:33,000
Podemos usar o comando "script/generate scaffold" para criar o modelo de "Post" e o controle pra gerencia-lo.

8
00:00:33,134 --> 00:00:36,850
Esse vai ter um tÃ­tulo e um corpo.

9
00:00:40,025 --> 00:00:45,069
Um dos arquivos que foi gerado aqui Ã© o arquivo "migration" e ele Ã© um jeito fÃ¡cil de administrar seu esquema de banco de dados.

10
00:00:45,169 --> 00:00:48,018
EntÃ£o aqui estamos criando uma tabela para "Posts" com algumas colunas.

11
00:00:48,118 --> 00:00:54,454
Agora podemos executar aquela "migration" com o comando "rake db:migrate" e isso vai cria a tabela de "Posts".

12
00:00:54,554 --> 00:00:55,611
Podemos iniciar nosso servidor.

13
00:00:58,189 --> 00:01:00,975
EntÃ£o podemos ir na url de Posts no browser e ver o que o esquema gerou.

14
00:01:02,229 --> 00:01:03,692
Como podemos ver aqui, podemos cria novos Posts

15
00:01:07,034 --> 00:01:09,474
e ainda edita-los.

16
00:01:16,000 --> 00:01:19,000
Se formos para nosso modelo de "Post", podemos adicionar algumas validações aqui.

17
00:01:20,362 --> 00:01:24,100
Vamos ter certeza que tenhamos um corpo e um título.

18
00:01:25,000 --> 00:01:28,050
Vamos ver o que acontece se editarmos nosso post

19
00:01:28,150 --> 00:01:29,150
e remover o título

20
00:01:29,250 --> 00:01:33,460
ai está, ele diz "Título não pode ser vazio". Coloco de volta e funciona.

21
00:01:34,400 --> 00:01:38,560
Seria legal se nossa pagina fosse um pouco mais apresentável, especiamente a pagina que lista todos os posts.

22
00:01:38,660 --> 00:01:41,099
Então vamos voltar para nosso código e ver o que podemos fazer.

23
00:01:41,199 --> 00:01:45,600
Vou começar com o arquivo "show" de Posts e em vez de fazer isso aqui

24
00:01:45,700 --> 00:01:50,944
vou colar um código pra exibir o post e alguns links.

25
00:01:51,543 --> 00:01:56,494
Agora temos que fazer algo parecido no nosso index também ou vamos exibir muitos posts

26
00:01:56,540 --> 00:02:00,650
mas eu quero que os posts sejam parecidos então o podemos fazer é mover esse pedaço de código

27
00:02:00,660 --> 00:02:03,181
e colocá-lo num "partial" pra exibir em vários templates.

28
00:02:04,281 --> 00:02:09,681
Para criar um "partial" so precisamos criar um arquivo aqui, começando com <i>undescore</i>, vamos chama-lo de "Post"

29
00:02:10,612 --> 00:02:12,934
então e copiar aquele conteúdo aqui.

30
00:02:13,034 --> 00:02:20,034
Em vez de acessar por variável de instancia, vamos acessar por variável local "post" que estará disponível para nós neste <i>partial</i>.

31
00:02:20,134 --> 00:02:25,221
De volta ao nosso template "show", vamos exibir o <i>partial</i>. Se passarmos nosso "Post" pra ele, Rails é esperto o bastante

32
00:02:25,234 --> 00:02:28,234
para fazer o link pois chamamos nosso <i>partial</i> de "post".

33
00:02:28,654 --> 00:02:31,138
Vamos exibir esse <i>partial</i> também na nossa index.

34
00:02:31,238 --> 00:02:35,921
Em vez de lista uma tabela aqui, vamos chamar <i>partial</i> Posts.

35
00:02:36,021 --> 00:02:40,540
Para cada Post na lista de Posts, será exibido o <i>partial</i>.

36
00:02:40,937 --> 00:02:47,467
Se voltarmos para nosso browser e recarregar, ai está, muito mais bonito. Ainda poderiamos fazer muita coisa aqui mas vamos adiante.

37
00:02:47,694 --> 00:02:54,241
Até aqui só usamos a representação HTML dos nossos Posts mas se queremos interagir com nossa aplicação em outros modos?

38
00:02:54,785 --> 00:02:58,085
Tudo que temos que fazer é adicionar uma extensão a nossa URL, então se chamarmos "post.xml"

39
00:02:58,186 --> 00:03:04,050
receberemos a representaçao XML dos nossos posts e poderemos usar XML pra gerenciar um post completamente.

40
00:03:05,991 --> 00:03:11,587
Se olharmos nosso controler de Posts podemos ver como isso funciona. É somente um bloco "respond_to" que lista os formatos que aceitamos,

41
00:03:11,687 --> 00:03:15,906
sendo assim é muito facil adicionar mais com somente uma linha. Então aqui adicionamos "json",

42
00:03:16,789 --> 00:03:22,517
agora é chamar com a extensão "json", aí está, nosso Post em formato JSON.

43
00:03:23,430 --> 00:03:27,470
Que tipo de blog é esse que não tem nenhum tipo "feed"? Então vamos adicionar um feed

44
00:03:27,314 --> 00:03:31,314
fazendo com que ele responda ao formato "atom". Se deixarmos assim será mostrado sem um arquivo,

45
00:03:31,414 --> 00:03:39,057
então assim como o html é mostrado em uma versão html do arquivo, vamos fazer uma visão do index pra "atom".

46
00:03:39,776 --> 00:03:43,910
Então vamos criar um novo arquivo, vamos chama-lo de "index" que é o nome de nossa ação,

47
00:03:43,910 --> 00:03:49,931
"atom" que é o formato, e qualquer linguagem de template, poderiamos usar "erb" aqui

48
00:03:49,552 --> 00:03:53,599
mas vamos usar "builder" por que é muito bom para montar arquivos XML.

49
00:03:53,685 --> 00:03:59,119
Deixe-me adicionar um pouco de código aqui pra gerar o feed. Basicamente ele percorre todos os posts

50
00:03:59,120 --> 00:04:01,668
e faz uma nova entrada do feed para cada um.

51
00:04:01,859 --> 00:04:07,080
Se chamarmos nossa url de posts novamente com a extensão "atom", ai está, nosso atom feed.

52
00:04:08,360 --> 00:04:13,143
Podemos ir agora para o nosso arquivo de layout de post e dentro do HEAD vamo adicionar um código

53
00:04:13,243 --> 00:04:19,394
chamado "auto_discovery_link_tag" para criar um link com o nosso feed.

54
00:04:19,877 --> 00:04:26,843
Se recarregarmos nosso site novamente, agora temos um link RSS aqui onde nos leva ao nosso feed de ATOM.

55
00:04:26,943 --> 00:04:28,933
Muito legal.

56
00:04:29,033 --> 00:04:32,001
Mas se alguem vier aqui e editar no nosso post pode inserir coisas ofensivas,

57
00:04:32,200 --> 00:04:35,896
nós não queremos isso então vamos proteger nos proteger com uma autenticação básica.

58
00:04:36,696 --> 00:04:41,147
De volta ao nosso controller de posts, podemos inserir comportamento usando "before_filter",

59
00:04:41,247 --> 00:04:42,447
vamos chama-lo de "authenticate".

60
00:04:43,933 --> 00:04:47,764
Isso é quando queremos mudar um comportamento quando uma dada ação é chamada.

61
00:04:47,864 --> 00:04:55,102
Então queremos que tudo seja autenticado menos as ações "index" e "show".

62
00:04:55,202 --> 00:05:02,927
Podemos adicionar o método de autenticação aqui embaixo, vamos fazê-lo privado, ele não é uma ação pública

63
00:05:03,027 --> 00:05:05,027
e vamos chama-lo de "authenticate".

64
00:05:05,127 --> 00:05:09,986
E aqui dentro podemos inserir um código para fazer autenticação HTTP básica,

65
00:05:10,086 --> 00:05:13,330
so pra garantir que o usuário é "admin" e a senha é "secret".

66
00:05:13,430 --> 00:05:17,741
Se isso falhar o usuário não poderá continuar com a ação.

67
00:05:17,841 --> 00:05:22,757
Se tentarmos editar esse post novamente, receberemos uma caixa de autenticação, informo os dados

68
00:05:22,857 --> 00:05:26,001
e aí esta, agora podemos continuar.

69
00:05:26,101 --> 00:05:31,440
Vamos tentar editar e ver se funciona, aí está, somente administradores podem editar.

70
00:05:31,540 --> 00:05:35,040
Não seria legal se outros podessem adicionar comentários a esse post?

71
00:05:35,140 --> 00:05:40,427
Novamente vamos usar o comando "script/generate scaffold" para gerar um modelo e controle de Comentario.

72
00:05:40,527 --> 00:05:48,481
E vamos da-lo uma coluna chamada "post_id" que será usado pra determinar a que post o comentário pertence,

73
00:05:48,581 --> 00:05:51,341
e podemos da-lo um corpo pra o texto.

74
00:05:51,441 --> 00:05:56,495
Não esqueça de executar a migração com o comando "rake db:migrate" pra gerar a tabela de comentário.

75
00:05:56,595 --> 00:06:00,791
Agora temos dois modelos, Comentario e Post, e eles precisam ser associados.

76
00:06:00,891 --> 00:06:04,367
Se fomos no nosso Post podemos dizer que ele tem muitos comentários (has_many: comments)

77
00:06:04,467 --> 00:06:09,429
e em Comentario dizer que ele pertence a um Post (belongs_to: Post).

78
00:06:09,529 --> 00:06:14,653
Agora usamos aquela coluna "post_id" em Comentario para liga-los.

79
00:06:14,753 --> 00:06:20,412
Podemos também fazer essa associação no nosso arquivo de rotas, informando que Posts tem muitos Comentarios.

80
00:06:24,387 --> 00:06:30,629
O que isso faz é adicionar comentario dentro de nosso url de post, que podemos ver se chamarmos o comando "rake routes".

81
00:06:31,465 --> 00:06:37,781
É um pouco difícil de ver nessa tela pequena mas você pode ver que temos posts e então temos comentarios na url de posts.

82
00:06:37,881 --> 00:06:38,881


